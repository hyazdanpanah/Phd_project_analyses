---
title: "ice fishing"
author: 
- Hediyeh Yazdanpanah
- Frederic Maps 
date: "2025-05-15"
output: 
  html_document:
    code_folding : show
    highlight    : pygments
    theme        : yeti
    toc          : TRUE
    toc_depth    : 4
    toc_float:
      collapsed     : TRUE
      smooth_scroll : TRUE
    df_print     : paged
    fig_caption  : TRUE
---
# Ice Fishing Exposure Analysis

## Introduction to Winter Recreational Fishing in the Saguenay Fjord

Winter recreational fishing, commonly known as ice fishing, represents a significant seasonal human activity in the Saguenay Fjord. The winter recreational groundfish fishery in the Saguenay Fjord operates under DFO regulation from January to March annually, attracting thousands of participants to the frozen fjord surface (Gauthier et al., 2020). This intensive seasonal activity creates concentrated areas of human disturbance that may impact benthic communities through multiple pathways.

The Saguenay Fjord supports one of Canada's most concentrated ice fishing activities, with ephemeral ice fishing villages of up to 900 colourful cabins established on the fjord surface during winter months. Since 1995, DFO has coordinated a comprehensive monitoring program for the winter recreational fishery, providing long-term data on fishing effort and catch composition (Gauthier et al., 2020), making this an ideal system for quantifying recreational fishing exposure.

## Ice Fishing as a Human-Induced Stressor

**Direct Physical Disturbance**

Ice fishing activities create multiple forms of direct physical disturbance to benthic habitats. The establishment of fishing holes through the ice layer, placement of temporary structures, and concentrated human activity over discrete areas generate localized disturbance pressures. Fishing disturbance can alter marine habitats and ecosystems, with the pressure/state relationship providing a basis for implementing management measures that minimize impacts (Sciberras et al., 2017).

**Localized Impact Zones and Threshold Effects**

The Saguenay Fjord, extending over 105 kilometers in length, supports multiple fishing villages distributed throughout the fjord system during the winter season. While up to 900 ice fishing cabins operate across the fjord, these structures are organized into discrete fishing villages, each typically containing 50-150 cabins concentrated in preferred fishing locations (Gauthier et al., 2020). This spatial organization creates multiple localized impact zones rather than a single concentrated disturbance area.

Research on recreational fishing impacts demonstrates that even moderate levels of fishing activity can create measurable effects on benthic communities, with the intensity of impact correlating strongly with the concentration of fishing effort in discrete areas (Radford et al., 2019). In ice fishing contexts, localized impacts occur through several mechanisms: concentrated organic loading from fish processing waste, repeated drilling of fishing holes through ice, placement of temporary structures, and cumulative disturbance from sustained human activity over discrete areas during the 8-week fishing season.

Studies of winter recreational fishing impacts indicate that concentrated seasonal activities can produce detectable changes in local benthic community structure, particularly in areas subject to repeated use over multiple seasons (Zawadská et al., 2024). The establishment of semi-permanent fishing villages creates zones of enhanced environmental pressure that may exceed background disturbance levels, while the majority of the fjord system remains unaffected by direct ice fishing activities.

**Cumulative Impact Assessment**

While individual ice fishing activities generate relatively modest environmental impacts, the cumulative effect of multiple fishing villages operating simultaneously throughout the fjord creates a spatially heterogeneous disturbance pattern. Each fishing village represents a localized zone of concentrated activity where cumulative impacts may significantly exceed those of dispersed recreational fishing (Radford et al., 2019). 

The temporal concentration of ice fishing activities during the winter months means that disturbance occurs when benthic communities may be less resilient due to reduced metabolic activity in cold-water conditions (Galbraith & Winkler, 2012). Recovery processes must occur during the brief ice-free season, potentially limiting the ability of benthic communities to fully recover before the subsequent winter fishing season.
## Benthic Community Vulnerability in Arctic-Subarctic Systems

**Environmental Context of the Saguenay Fjord**

The Saguenay Fjord shares characteristics with coastal Arctic marine ecosystems: it is seasonally ice-covered, receives important freshwater runoff, hosts diverse plankton, fish, marine mammals and birds, and plays important economic and social roles for local communities (Galbraith & Winkler, 2012). The fjord supports numerous types of algae, benthic animals and fish that form a complex food chain supporting significant biodiversity.

**Sensitivity of Cold-Water Benthic Communities**

Research in cold-water marine systems demonstrates particular vulnerability of benthic communities to anthropogenic disturbance. Studies in Antarctic coastal environments found that small research stations can have impacts of equal or greater severity on marine benthic communities as large, heavily contaminated stations, with significant loss of biodiversity at disturbed sites (Barnes & Conlan, 2007). 

In cold marine environments, ice scour represents a natural disturbance that removes benthic biomass, modifies abundance and diversity patterns, and changes community structure and function (Barnes & Conlan, 2007). However, anthropogenic disturbances such as fishing can significantly alter community composition and foodweb architecture, with removal of structural engineers and homogenizing of sediments altering benthic habitat in ways that may not be suitable for settlement of recruits from the original community (Clark et al., 2016).

## Recreational Fishing Impact Mechanisms

**Sediment and Habitat Disruption**

Experimental studies of benthic disturbance demonstrate that fishing activities immediately affect benthic fluxes and sediment biogeochemistry, with sediment properties (chlorophyll, organic carbon, and water content) changing significantly and macrofauna being removed completely (Tiano et al., 2022). Even seasonal fishing activities can produce short-term changes in macrofaunal community structure, though the duration and extent of impacts vary with fishing intensity and habitat characteristics (Harris & Poiner, 1991).

**Community Structure Alterations**

Fishing disturbance is considered a major stressor in marine ecosystems that can negatively impact biodiversity, species populations, and ecosystem services (Clark et al., 2016). Research demonstrates taxon-specific responses at various thresholds, with significant increases in abundance of scavenging species (epifaunal echinoderms, infaunal crustaceans) by two to four-fold in fished areas, contrasted with decreases in sessile epifaunal organisms (Sciberras et al., 2017).

## Methodology: Spatial Modeling of Ice Fishing Exposure

**Cabin-Based Intensity Mapping**

This analysis utilized DFO data on cabin numbers and locations from the regulated winter recreational groundfish fishery to quantify ice fishing pressure (Gauthier et al., 2020). The spatial distribution of ice fishing cabins provides a proxy for fishing intensity, as these structures represent concentrated areas of fishing activity over the winter season.

**Exposure Modeling Approach**

The exposure model employs a decay function approach (Level IV decay: a = -0.0001) to represent the spatial extent of ice fishing impacts radiating from cabin locations. This methodology recognizes that benthic impacts from concentrated fishing activities extend beyond the immediate footprint of fishing holes and cabin placement, affecting surrounding benthic communities through sediment resuspension, waste deposition, and cumulative disturbance effects (Thrush et al., 1998).

**Proportional Weighting System**

Exposure calculations incorporated proportional weighting based on cabin density at each site, acknowledging that the intensity and cumulative impact of recreational fishing varies significantly with participation rates and local concentrations of activity (Radford et al., 2019). This approach provides a spatially-explicit assessment of relative exposure risk throughout the fjord system.

## Management and Conservation Implications

**Regulatory Framework**

The Saguenay Fjord winter recreational fishery operates under specific regulations including daily catch limits (5 groundfish per person), gear restrictions (hand-line or angling only), and mandatory release requirements for certain species including Greenland shark, crustaceans and shellfish (Gauthier et al., 2020). However, current regulations focus primarily on fish stock conservation rather than benthic habitat protection.

**Research Needs and Monitoring**

Mapping recreational fishing ecosystem services and impacts requires standardized protocols and systematic monitoring approaches (Zawadská et al., 2024). Assessment of impacts from recreational fishing is challenging, particularly when activities occur at large scales over areas of high environmental variability, necessitating functional group approaches to assess broad-scale patterns in ecological processes (Hewitt et al., 2018).



# First scenario based on number of canib 
This is the first senarion for ice fishing in SF based on the <a href="https://epe.bac-lac.gc.ca/100/201/301/weekly_acquisitions_list-ef/2017/17-19/publications.gc.ca/collections/collection_2017/mpo-dfo/Fs70-5-2017-022-fra.pdf?nodisclaimer=1">number of cabin</a> in 2018 reported by DFO. 

* For Ice-fishing Exposure we considered **decay_type <- "IV"**

```{r setup, include=FALSE}

# library needed
library(terra)
library(sf)
library(gdistance)
library(dplyr)
library(raster)
library(ggplot2)
library(gstat)
library(viridis)
library(RColorBrewer)
library(scales)
library(grid)
library(readxl)
library(jsonlite)
```

```{r Ice fishing load data and layer creation}
# load Data # 
bathy     <- raster("bathy.tif")
ice_fishing <- st_read("ice fishing saguenay_2018.shp")

# Define target CRS (UTM Zone 19N)
target_crs <- "+proj=utm +zone=19 +datum=WGS84 +units=m +no_defs"

# Reproject bathy to UTM Zone 19N
bathy_utm <- projectRaster( bathy, 
                            crs = target_crs )

# Define Saguenay Fjord extent in UTM coordinates
xmin <- 345000  #335341.9
ymin <- 5325000 #5320125
xmax <- 450000  #453741.9
ymax <- 5370000 #5383225
saguenay_extent <- extent( xmin,
                           xmax,
                           ymin,
                           ymax )

# Reproject cropped raster to use in the rest of the analysis
bathy_proj   <- crop( bathy_utm,
                      saguenay_extent )

# Reduce resolution of bathymetry raster
bathy_200 <- projectRaster( bathy_proj,
                            crs = target_crs,
                            res = c(200, 200) )

# Replace values > 0 (land) with 0 for calculations
bathy_200[ bathy_200>0 ] <- 0
# -----------------Define transition function -----------------#
fun_bathy <- function(x) {
  # Check if first cell is shallower than second
  ifelse( x[1] > x[2],
          # Account for negative values
          pmax( 0.001, 1 - abs( (x[2] - x[1]) / x[2] ) ),
          # Default conductance for uphill movement (make it difficult)
          0.45)
}

# --------------------Create transition layer-----------------#
tr_bathy <- transition( bathy_200, 
                        transitionFunction = fun_bathy,
                        directions         = 8,
                        symm               = FALSE) %>%
  # Apply geocorrection to transition layer
  geoCorrection( ., 
                 type = "c")

# Convert TransitionLayer to temporary raster for ploting
tr_raster  <- raster( tr_bathy )
crs(tr_raster) <- target_crs


#______________________________ADD SITES____________________________#
# Function to find the nearest non-NA cell in case the
nearest_valid_cell <- function( point, raster ) {
  
  # Find valid cells
  valid_cells <- which( !is.na( values(raster) ), 
                        arr.ind = TRUE )
  # Get their coordinates
  valid_coords <- xyFromCell( raster,
                              valid_cells )
   # Compute Euclidean distances from the point to valid cells
  distances <- sqrt( ( valid_coords[,1] - point[1] )^2 + 
                       ( valid_coords[,2] - point[2] )^2 )
  
  # Get the closest valid cell
  nearest_idx <- which.min( distances )
  
  return( valid_coords[ nearest_idx, , drop=FALSE ] )
}

# Transform to your target CRS (same as used for WWTP)
# Convert to an sf object (spatial data frame)
ice_fishing_sf <- st_as_sf(ice_fishing, 
                                coords = c("lon", "lat"),
                                crs = 4326)  # WGS84 coordinate system
ice_fishing_sf <- st_transform(ice_fishing_sf, crs = target_crs)  

# If needed, adjust station locations to nearest valid bathymetry cell
# Loop through each station that needs adjustment
  for (i in 1:nrow(ice_fishing_sf)) {
    st_geometry(ice_fishing_sf[i,]) <- nearest_valid_cell(
      st_coordinates(ice_fishing_sf[i,]),
      bathy_200
    ) %>%
      st_point() %>%
      st_sfc() %>%
      st_set_crs(target_crs)
  }
#__________________plot the ice station_____________________________

plot(bathy_200)
coords <- st_coordinates(ice_fishing_sf)
points(coords, pch=16, col="black")  

# Add labels for each ice fishing station
for (i in 1:nrow(ice_fishing_sf)) {
  # Create short code for site name (first 3 letters)
  site_code <- substr(ice_fishing_sf$site[i], 1, 3)
  
  # Add text label
  text(
    st_coordinates(ice_fishing_sf[i,]),
    site_code,
    pos=4,         # Position text to the right of point
    col="black",    # Blue text to match points
    cex=0.8        # Slightly smaller text
  )
}
```

# Create grid polygon and grid point

```{r create polygon and points grid}
#_____________Create grid Polygon and grid point___________________#

# Define bounding box coordinates 
xmin <- 345000  #335341.9
ymin <- 5325000 #5320125
xmax <- 450000  #453741.9
ymax <- 5370000 #5383225

# Create bbox_utm object
bbox_utm <- list( rbind( c(xmin, ymin),
                         c(xmax, ymin),
                         c(xmax, ymax),
                         c(xmin, ymax),
                         c(xmin, ymin) ) ) %>%
  st_polygon()                   %>%
  st_sfc( ., crs = target_crs )

# Define grid resolution (200 meters)
grid_res <- 200

# Create grid polygons
grid_polygons <- st_make_grid( bbox_utm, 
                               cellsize = grid_res, 
                               what     = "polygons" ) %>% 
  st_sf()

# Create grid points
grid_points <- st_make_grid( bbox_utm, 
                             cellsize = grid_res, 
                             what     = "centers" ) %>%
  st_sf()
```

# Define the RelativeExposure Function

```{r function}
##______________________Define the RelativeExposure function_____________#
RelativeExposure <- function( source,
                              transition,
                              decay_type,
                              grid_points_sf, 
                              grid_polygons_sf,
                              empty_raster ) {
  # Verify input CRS match
  if ( !identical( st_crs(source), st_crs(grid_points_sf) ) ) {
    stop( "CRS mismatch between source and grid points" )
  }
  
  # Calculate cost distance with error handling
  tryCatch( {
    # Convert sf objects to sp
    source_sp <- as( source,         "Spatial" )
    grid_points_sp <- as( grid_points_sf, "Spatial" )
    
    distance <- costDistance( transition, 
                              grid_points_sp,
                              source_sp )
    if ( all( is.na( distance ) ) ) {
      stop( "All distance values are NA" )
    }
    min_dist <- apply( distance, 1, min )
    
    # Verify distance calculation
    print( "Distance calculation summary:" )
    print( summary( as.vector( min_dist[ is.finite(min_dist) ] ) ) )
    
    # Calculate decay parameter
    a_param <- switch( decay_type,
                       "I"   = -1,
                       "II"  = -0.1,
                       "III" = -0.01,
                       "IV"  = -0.001,
                       stop( "Invalid decay type" ) )
    
    # Compute exposure values
    exposure <- exp((0.000025 * a_param) * (min_dist)^2)
    
    # Create exposure raster
    coords <- st_coordinates( grid_points_sf )
    sp_exposure <- SpatialPointsDataFrame(
      coords      = coords,
      data        = data.frame(exposure = exposure),
      proj4string = CRS( st_crs(empty_raster)$proj4string )
    )
    
    # Rasterize exposure values
    exposure_rast <- rasterize( sp_exposure, 
                                empty_raster, 
                                field      = "exposure", 
                                fun        = mean,
                                background = NA )
    
    # Normalize exposure values
    max_value <- cellStats( exposure_rast, 
                            stat  = "max",
                            na.rm = TRUE )
    exposure_rast[] <- exposure_rast[] / max_value
    
    return(exposure_rast)
    
  }, error = function(e) {
    stop( "Error in exposure calculation: ", e$message )
  } )
}
```

# Add parameters and compute exposure

```{r add parameters}
# Create an empty raster template with proper CRS and resolution
template_raster <- raster( extent(bathy_200), 
                           resolution = 200,
                           crs        = projection(bathy_200) )

#--- Set decay type 
decay_type <- "II"

# Calculate proportion of total cabins for each station
total_cabins <- sum(ice_fishing_sf$cabin_2018)
ice_fishing_sf$cabin_prop <- ice_fishing_sf$cabin_2018 / total_cabins

# Create scaling factors based on proportion of total cabins
scaling_factors <- setNames(
  ice_fishing_sf$cabin_prop,     # Proportion of cabins as scaling factors
  ice_fishing_sf$site            # Station names as names
)

# Create individual exposure fields for each ice fishing station
# Create separate objects for each station first
ice_LAB <- ice_fishing_sf[ice_fishing_sf$site == "L'Anse à Benjamin",]
ice_GB <- ice_fishing_sf[ice_fishing_sf$site == "Grand-Baie",]
ice_SF <- ice_fishing_sf[ice_fishing_sf$site == "Saint-Fulgence",]
ice_ASJ <- ice_fishing_sf[ice_fishing_sf$site == "L'Anse-Saint-Jean",]
ice_RE <- ice_fishing_sf[ice_fishing_sf$site == "Rivière Éternité",]
ice_SFO <- ice_fishing_sf[ice_fishing_sf$site == "Saint-Félix-d'Otis",]
ice_SRN <- ice_fishing_sf[ice_fishing_sf$site == "Saint-Rose-du-Nord",]

# Compute individual relative exposure fields
ice_LAB_exp <- RelativeExposure(ice_LAB,
                                tr_bathy,
                                decay_type, 
                                grid_points, 
                                grid_polygons,
                                template_raster)

ice_GB_exp <- RelativeExposure(ice_GB,
                               tr_bathy,
                               decay_type, 
                               grid_points, 
                               grid_polygons,
                               template_raster)

ice_SF_exp <- RelativeExposure(ice_SF,
                               tr_bathy,
                               decay_type, 
                               grid_points, 
                               grid_polygons,
                               template_raster)

ice_ASJ_exp <- RelativeExposure(ice_ASJ,
                                tr_bathy,
                                decay_type, 
                                grid_points, 
                                grid_polygons,
                                template_raster)

ice_RE_exp <- RelativeExposure(ice_RE,
                               tr_bathy,
                               decay_type, 
                               grid_points, 
                               grid_polygons,
                               template_raster)

ice_SFO_exp <- RelativeExposure(ice_SFO,
                                tr_bathy,
                                decay_type, 
                                grid_points, 
                                grid_polygons,
                                template_raster)

ice_SRN_exp <- RelativeExposure(ice_SRN,
                                tr_bathy,
                                decay_type, 
                                grid_points, 
                                grid_polygons,
                                template_raster)

# Define scaling factors based on cabin proportions
s_ice_LAB <- ice_fishing_sf$cabin_prop[ice_fishing_sf$site == "L'Anse à Benjamin"]
s_ice_GB <- ice_fishing_sf$cabin_prop[ice_fishing_sf$site == "Grand-Baie"]
s_ice_SF <- ice_fishing_sf$cabin_prop[ice_fishing_sf$site == "Saint-Fulgence"]
s_ice_ASJ <- ice_fishing_sf$cabin_prop[ice_fishing_sf$site == "L'Anse-Saint-Jean"]
s_ice_RE <- ice_fishing_sf$cabin_prop[ice_fishing_sf$site == "Rivière Éternité"]
s_ice_SFO <- ice_fishing_sf$cabin_prop[ice_fishing_sf$site == "Saint-Félix-d'Otis"]
s_ice_SRN <- ice_fishing_sf$cabin_prop[ice_fishing_sf$site == "Saint-Rose-du-Nord"]

# Combine individual exposure values using proportional weights
ice_fishing_exp <- ice_LAB_exp * s_ice_LAB +
  ice_GB_exp * s_ice_GB +
  ice_SF_exp * s_ice_SF +
  ice_ASJ_exp * s_ice_ASJ +
  ice_RE_exp * s_ice_RE +
  ice_SFO_exp * s_ice_SFO +
  ice_SRN_exp * s_ice_SRN

# Only replace background zeros with NA (where bathymetry is NA)
# Keep zeros from the exposure calculation
ice_fishing_exp[is.na(bathy_200)] <- NA

# Normalize to [0,1] range for final exposure index
ice_fishing_exp_II <- ice_fishing_exp / max(values(ice_fishing_exp), na.rm = TRUE)

# Extract exposure values for histogram
exposure_values_ice <- values(ice_fishing_exp_II)
exposure_values_ice <- exposure_values_ice[!is.na(exposure_values_ice)]

# Save the exposure raster 
writeRaster(ice_fishing_exp_II, "ice_fishing_exposure.tif", overwrite=TRUE)

# Save the exposure raster in .RData format
save(ice_fishing_exp_II, file = "ice_fishing_exposure.RData")
```

```{r plot}
png("icfiII.png")
# Plot the exposure map
plot(ice_fishing_exp_II, 
     main="Ice Fishing Exposure (Weighted by Cabin Proportions) type II",
     xlim = c(xmin, xmax),
     ylim = c(ymin, ymax))
# Add scale bar
scalebar(d = 10000,  # distance in meters (adjust based on your map size)
         xy = NULL,   # NULL = bottom left corner
         type = "bar",
         divs = 2,
         below = "km",
         label = c(0, 5, 10))

# Add station points
#points(st_coordinates(ice_fishing_sf), pch=16, cex=0.4, 
 #      col="black")

# Create a mapping between full site names and your preferred abbreviations
#station_abbr <- c(
 # "L'Anse à Benjamin" = "LAB",
  #"Grand-Baie" = "GB",
  #"Saint-Fulgence" = "SF",
  #"L'Anse-Saint-Jean" = "ASJ",
  #"Rivière Éternité" = "RE",
  #"Saint-Félix-d'Otis" = "SFO",
  #"Saint-Rose-du-Nord" = "SRN"
#)

# Add station labels with your custom abbreviations
#for (i in 1:nrow(ice_fishing_sf)) {
  # Get the current site name
 # site_name <- ice_fishing_sf$site[i]
  
  # Get the custom abbreviation
  #abbr <- station_abbr[site_name]
  
  # Add text to the plot
  #text(
   # st_coordinates(ice_fishing_sf[i,]),
    #abbr,
    #pos=4,
    #offset=0.5,
    #cex=0.7
  #)
#}
dev.off()
```

```{r histogram plot}

# _________________histogram plot_______________________ 
# Create a data frame with abbreviations and proportions
plot_data <- data.frame(
  Station = station_abbr[ice_fishing_sf$site],
  Proportion = ice_fishing_sf$cabin_prop
)

# Sort by proportion in descending order
plot_data <- plot_data[order(plot_data$Proportion, decreasing = TRUE),]

# Convert Station to a factor with levels in the correct order for plotting
plot_data$Station <- factor(plot_data$Station, levels = plot_data$Station)

# Basic histogram using barplot
barplot(
  plot_data$Proportion, 
  names.arg = plot_data$Station,
  col = "lightblue",
  main = "Proportion of Cabins by Ice Fishing Station",
  ylab = "Proportion",
  xlab = "Station",
  ylim = c(0, max(plot_data$Proportion) * 1.1),  # Add space for text
  las = 1  # Make y-axis labels horizontal
)

# Add percentage labels on top of each bar
text(
  x = seq(0.7, by = 1.2, length.out = nrow(plot_data)),  # Position horizontally above bars
  y = plot_data$Proportion + 0.01,  # Position slightly above bars
  labels = paste0(round(plot_data$Proportion * 100, 1), "%"),  # Format as percentage
  cex = 0.8  # Text size
)
```
## Conclusion

Ice fishing in the Saguenay Fjord represents a concentrated seasonal stressor that may significantly impact benthic communities through direct physical disturbance, habitat alteration, and cumulative effects. The high density of fishing cabins (up to 900 structures) creates intensive localized pressure that, when modeled using spatial exposure techniques, reveals potentially significant impact gradients throughout the fjord ecosystem. 

Understanding these exposure patterns is critical for implementing ecosystem-based management approaches that balance recreational fishing opportunities with benthic habitat conservation in this unique Arctic-subarctic marine system (Galbraith & Winkler, 2012). 

## References

Barnes, D. K. A., and K. E. Conlan. 2007. Disturbance, colonization and development of Antarctic benthic communities. Philosophical Transactions of the Royal Society B 362:11-38.

Clark, M. R., F. Althaus, T. A. Schlacher, A. Williams, D. A. Bowden, and A. A. Rowden. 2016. The impacts of deep-sea fisheries on benthic communities: a review. ICES Journal of Marine Science 73:i51-i69.

Galbraith, P. S., and G. Winkler. 2012. Exploratory observations of winter oceanographic conditions in the Saguenay Fjord. Atmosphere-Ocean 50:17-30.

Gauthier, J., M.-C. Marquis, A. E. Valentin, and É. Parent. 2020. The Saguenay Fjord winter recreational groundfish fishery, 1996-2018. DFO Canadian Science Advisory Secretariat Research Document 2020/054.

Harris, A. N., and I. R. Poiner. 1991. Changes in species composition of demersal fish fauna of Southeast Gulf of Carpentaria, Australia, after 20 years of fishing. Marine Biology 111:503-519.

Hewitt, J. E., S. F. Thrush, J. Halliday, and C. Duffy. 2018. Assessing benthic responses to fishing disturbance over broad spatial scales that incorporate high environmental variation. Frontiers in Marine Science 5:405.

Radford, Z., L. Zarauz, H. V. Strehlow, J. Ferter, R. Prellezo, M. Scarcella, et al. 2019. Potential environmental impacts of recreational fishing on marine fish stocks and ecosystems. Reviews in Fisheries Science & Aquaculture 27:287-324.

Sciberras, M., S. R. Jenkins, M. J. Kaiser, S. J. Hawkins, and A. S. Pullin. 2017. Defining thresholds of sustainable impact on benthic communities in relation to fishing disturbance. Scientific Reports 7:5440.

Thrush, S. F., J. E. Hewitt, V. J. Cummings, P. K. Dayton, M. Cryer, S. J. Turner, G. A. Funnell, R. G. Budd, C. J. Milburn, and M. R. Wilkinson. 1998. Disturbance of the marine benthic habitat by commercial fishing: impacts at the scale of the fishery. Ecological Applications 8:866-879.

Tiano, J. C., P. van der Reijden, S. O'Flynn, K. Beauchard, O. Eland, U. Broszeit, P. J. van der Veer, T. Ysebaert, and A. D. Rijnsdorp. 2022. Impacts of bottom trawling on benthic biogeochemistry in muddy sediments: removal of surface sediment using an experimental field study. Biogeosciences 19:3763-3784.

Zawadská, N., N. Stašaitytė, A. Akstinas, and R. Povilanskas. 2024. A simple method for mapping winter recreational fishing ecosystem services supply in lakes: a contribution to mapping freshwater ecosystem services. Scientific Reports 14:12234.


# Secend scenarion based on the Total Effort Index #

This is the second scenarion for ice fishing in SF based on the <a href="https://publications.gc.ca/collections/collection_2021/mpo-dfo/fs70-5/Fs70-5-2020-054-fra.pdf#page=53.15">total effort index</a> in 2018 reported by DFO. 
This index will be compute : 
$$FE_i = (F_{wd,i} \times N_{wd}) + (F_{we,i} \times N_{we})$$

Where:
$FE_i$ = Total fishing effort for station $i$
$F_{wd,i}$ = Number of fishermen on weekdays at station $i$
$N_{wd}$ = Number of weekdays in the fishing season
$F_{we,i}$ = Number of fishermen on weekends at station $i$
$N_{we}$ = Number of weekend days in the fishing season

```{r total effort index}
#create data frame
# Create the fishing data frame for 2018
fishing_data <- data.frame(
  Station = c("Anse-à-Benjamin", "Anse-Saint-Jean", "Grande Baie", 
              "Rivière Éternité", "Sainte-Rose-du-Nord", 
              "Saint-Félix-d'Otis", "Saint-Fulgence"),
  
  Weekday_Fishermen = c(131, 70, 141, 0, 28, NA, NA),  # NA for NE (not sampled)
  
  Weekend_Fishermen = c(257, 151, 295, 0, 55, NA, NA),  # NA for NE (not sampled)
  
  Weekdays = rep(35, 7),  # All stations have the same number of weekdays
  
  Weekend_Days = rep(15, 7),  # All stations have the same number of weekend days
  
  Cabins_2018 = c(479, 148, 428, 27, 87, 25, 126)
)

# Now you can calculate fishing effort using this formula:
fishing_data$Total_Fishing_Effort <- with(fishing_data, 
  (Weekday_Fishermen * Weekdays) + (Weekend_Fishermen * Weekend_Days))

# View the data
fishing_data
```
Now compute exposure value based in total effort index 

```{r total effort index exposure}

# Create an empty raster template with proper CRS and resolution
template_raster <- raster(
  extent(bathy_200),
  resolution = 200,
  crs = projection(bathy_200)
)

#--- Set decay type 
decay_type <- "IV"

# Create the fishing effort data frame with corrected site names
# Make sure these match exactly with your ice_fishing_sf$site names
fishing_effort <- data.frame(
  site = c("L'Anse à Benjamin", "L'Anse-Saint-Jean", "Grand-Baie", 
           "Rivière Éternité", "Saint-Rose-du-Nord", 
           "Saint-Félix-d'Otis", "Saint-Fulgence"),
  
  effort_2018 = c(8440, 4715, 9360, 0, 1805, NA, NA)
)

# Debug: Check site name matching
print("Sites in ice_fishing_sf:")
print(ice_fishing_sf$site)
print("Sites in fishing_effort:")
print(fishing_effort$site)

# For stations with NA effort, estimate based on their cabin count
# Calculate average effort per cabin from stations with known values
stations_with_data <- !is.na(fishing_effort$effort_2018) & fishing_effort$effort_2018 > 0
total_known_effort <- sum(fishing_effort$effort_2018[stations_with_data], na.rm = TRUE)

# Get cabin counts for stations with known effort - use cabin_2018, not cabin_2016
known_effort_sites <- fishing_effort$site[stations_with_data]
total_known_cabins <- 0

for(site in known_effort_sites) {
  cabin_count <- ice_fishing_sf$cabin_2018[ice_fishing_sf$site == site]
  if(length(cabin_count) > 0) {
    total_known_cabins <- total_known_cabins + cabin_count
  } else {
    print(paste("Warning: No match found for site:", site))
  }
}

print(paste("Total known effort:", total_known_effort))
print(paste("Total known cabins:", total_known_cabins))

effort_per_cabin <- total_known_effort / total_known_cabins
print(paste("Effort per cabin:", effort_per_cabin))

# Estimate effort for stations with NA values
for(i in which(is.na(fishing_effort$effort_2018))) {
  site_name <- fishing_effort$site[i]
  print(paste("Processing site:", site_name))
  
  # Find matching cabin count - use cabin_2018
  station_cabins <- ice_fishing_sf$cabin_2018[ice_fishing_sf$site == site_name]
  
  if(length(station_cabins) > 0 && !is.na(station_cabins)) {
    estimated_effort <- station_cabins * effort_per_cabin
    fishing_effort$effort_2018[i] <- estimated_effort
    print(paste("Estimated effort for", site_name, ":", estimated_effort))
  } else {
    print(paste("Warning: Could not find cabin data for", site_name))
    # Set to 0 if no cabin data found
    fishing_effort$effort_2018[i] <- 0
  }
}

# Display final effort data
print("Final fishing effort data:")
print(fishing_effort)

# Merge effort data into the spatial data frame
# Create a temporary data frame to ensure proper matching
effort_lookup <- setNames(fishing_effort$effort_2018, fishing_effort$site)

# Add effort column to ice_fishing_sf
ice_fishing_sf$effort_2018 <- effort_lookup[ice_fishing_sf$site]

# Handle any remaining NAs
ice_fishing_sf$effort_2018[is.na(ice_fishing_sf$effort_2018)] <- 0

# Calculate proportion of total effort for each station
total_effort <- sum(ice_fishing_sf$effort_2018, na.rm = TRUE)
ice_fishing_sf$effort_prop <- ice_fishing_sf$effort_2018 / total_effort

print("Effort proportions:")
print(data.frame(
  site = ice_fishing_sf$site,
  effort_2018 = ice_fishing_sf$effort_2018,
  effort_prop = ice_fishing_sf$effort_prop
))

# Continue with the rest of your exposure calculation...
# Create scaling factors based on proportion of total effort
scaling_factors <- setNames(
  ice_fishing_sf$effort_prop,   # Proportion of effort as scaling factors
  ice_fishing_sf$site           # Station names as names
)

# Create individual exposure fields for each ice fishing station
# Create separate objects for each station first
ice_LAB <- ice_fishing_sf[ice_fishing_sf$site == "L'Anse à Benjamin",]
ice_GB <- ice_fishing_sf[ice_fishing_sf$site == "Grand-Baie",]
ice_SF <- ice_fishing_sf[ice_fishing_sf$site == "Saint-Fulgence",]
ice_ASJ <- ice_fishing_sf[ice_fishing_sf$site == "L'Anse-Saint-Jean",]
ice_RE <- ice_fishing_sf[ice_fishing_sf$site == "Rivière Éternité",]
ice_SFO <- ice_fishing_sf[ice_fishing_sf$site == "Saint-Félix-d'Otis",]
ice_SRN <- ice_fishing_sf[ice_fishing_sf$site == "Saint-Rose-du-Nord",]

# Compute individual relative exposure fields
ice_LAB_exp <- RelativeExposure(ice_LAB,
                               tr_bathy,
                               decay_type,
                               grid_points,
                               grid_polygons,
                               template_raster)
ice_GB_exp <- RelativeExposure(ice_GB,
                              tr_bathy,
                              decay_type,
                              grid_points,
                              grid_polygons,
                              template_raster)
ice_SF_exp <- RelativeExposure(ice_SF,
                              tr_bathy,
                              decay_type,
                              grid_points,
                              grid_polygons,
                              template_raster)
ice_ASJ_exp <- RelativeExposure(ice_ASJ,
                               tr_bathy,
                               decay_type,
                               grid_points,
                               grid_polygons,
                               template_raster)
ice_RE_exp <- RelativeExposure(ice_RE,
                              tr_bathy,
                              decay_type,
                              grid_points,
                              grid_polygons,
                              template_raster)
ice_SFO_exp <- RelativeExposure(ice_SFO,
                               tr_bathy,
                               decay_type,
                               grid_points,
                               grid_polygons,
                               template_raster)
ice_SRN_exp <- RelativeExposure(ice_SRN,
                               tr_bathy,
                               decay_type,
                               grid_points,
                               grid_polygons,
                               template_raster)

# Define scaling factors based on fishing effort proportions
s_ice_LAB <- ice_fishing_sf$effort_prop[ice_fishing_sf$site == "L'Anse à Benjamin"]
s_ice_GB <- ice_fishing_sf$effort_prop[ice_fishing_sf$site == "Grand-Baie"]
s_ice_SF <- ice_fishing_sf$effort_prop[ice_fishing_sf$site == "Saint-Fulgence"]
s_ice_ASJ <- ice_fishing_sf$effort_prop[ice_fishing_sf$site == "L'Anse-Saint-Jean"]
s_ice_RE <- ice_fishing_sf$effort_prop[ice_fishing_sf$site == "Rivière Éternité"]
s_ice_SFO <- ice_fishing_sf$effort_prop[ice_fishing_sf$site == "Saint-Félix-d'Otis"]
s_ice_SRN <- ice_fishing_sf$effort_prop[ice_fishing_sf$site == "Saint-Rose-du-Nord"]

# Combine individual exposure values using proportional weights
ice_fishing_exp <- ice_LAB_exp * s_ice_LAB +
  ice_GB_exp * s_ice_GB +
  ice_SF_exp * s_ice_SF +
  ice_ASJ_exp * s_ice_ASJ +
  ice_RE_exp * s_ice_RE +
  ice_SFO_exp * s_ice_SFO +
  ice_SRN_exp * s_ice_SRN

# Replace zeros with NA
ice_fishing_exp[ice_fishing_exp == 0] <- NA

# Normalize to [0,1] range for final exposure index
ice_fishing_exp_III <- ice_fishing_exp / max(values(ice_fishing_exp), na.rm = TRUE)

# Extract exposure values for histogram
exposure_values_ice <- values(ice_fishing_exp_III)
exposure_values_ice <- exposure_values_ice[!is.na(exposure_values_ice)]

# Save the exposure raster 
writeRaster(ice_fishing_exp_III, "ice_fishing_exposure_effort.tif", overwrite=TRUE)

# Plot the exposure map
plot(ice_fishing_exp_III,
     main="Ice Fishing Exposure (Weighted by Fishing Effort)")

# Add station points
points(st_coordinates(ice_fishing_sf), pch=16, cex=0.4,
       col="black")

# Create a mapping between full site names and your preferred abbreviations
station_abbr <- c(
  "L'Anse à Benjamin" = "LAB",
  "Grand-Baie" = "GB",
  "Saint-Fulgence" = "SF",
  "L'Anse-Saint-Jean" = "ASJ",
  "Rivière Éternité" = "RE",
  "Saint-Félix-d'Otis" = "SFO",
  "Saint-Rose-du-Nord" = "SRN"
)

# Add station labels with your custom abbreviations
for (i in 1:nrow(ice_fishing_sf)) {
  # Get the current site name
  site_name <- ice_fishing_sf$site[i]
  
  # Get the custom abbreviation
  abbr <- station_abbr[site_name]
  
  # Add text to the plot
  text(
    st_coordinates(ice_fishing_sf[i,]),
    abbr,
    pos=4,
    offset=0.5,
    cex=0.7
  )
}
```
```{r comparison cabins}
# Create a data frame with station information and cabin counts
cabin_data <- data.frame(
  site = c("L'Anse à Benjamin", "L'Anse-Saint-Jean", "Grand-Baie", 
           "Rivière Éternité", "Saint-Rose-du-Nord", 
           "Saint-Félix-d'Otis", "Saint-Fulgence"),
  
  cabins_2018 = c(479, 148, 428, 27, 87, 25, 126)
)

# Create a mapping between full site names and abbreviations
station_abbr <- c(
  "L'Anse à Benjamin" = "LAB",
  "Grand-Baie" = "GB",
  "Saint-Fulgence" = "SF",
  "L'Anse-Saint-Jean" = "ASJ",
  "Rivière Éternité" = "RE",
  "Saint-Félix-d'Otis" = "SFO",
  "Saint-Rose-du-Nord" = "SRN"
)

# Create plot data with abbreviations
plot_data <- data.frame(
  Station = station_abbr[cabin_data$site],
  Cabins = cabin_data$cabins_2018
)

# Calculate proportions
total_cabins <- sum(plot_data$Cabins)
plot_data$Proportion <- plot_data$Cabins / total_cabins

# Sort by number of cabins in descending order
plot_data <- plot_data[order(plot_data$Cabins, decreasing = TRUE),]

# Convert Station to a factor with levels in the correct order for plotting
plot_data$Station <- factor(plot_data$Station, levels = plot_data$Station)

# Set up plot parameters
par(mar = c(5, 5, 4, 4) + 0.1)  # Adjust margins

# Create the bar chart
barplot(
  plot_data$Cabins, 
  names.arg = plot_data$Station,
  col = "lightgreen",
  main = "Number of Ice Fishing Cabins by Station (2018)",
  ylab = "Number of Cabins",
  xlab = "Station",
  ylim = c(0, max(plot_data$Cabins) * 1.1),  # Add space for labels
  las = 1,  # Make y-axis labels horizontal
  cex.names = 0.9  # Adjust size of station names
)

# Add cabin count labels on top of each bar
text(
  x = seq(0.7, by = 1.2, length.out = nrow(plot_data)),  # Position horizontally
  y = plot_data$Cabins + max(plot_data$Cabins) * 0.03,   # Position slightly above bars
  labels = plot_data$Cabins,  # Show actual cabin counts
  cex = 0.8  # Text size
)

# Add a second plot showing proportion of total cabins
par(mar = c(5, 5, 4, 4) + 0.1)
barplot(
  plot_data$Proportion, 
  names.arg = plot_data$Station,
  col = "darkgreen",
  main = "Proportion of Ice Fishing Cabins by Station (2018)",
  ylab = "Proportion of Total Cabins",
  xlab = "Station",
  ylim = c(0, max(plot_data$Proportion) * 1.1),  # Add space for text
  las = 1  # Make y-axis labels horizontal
)

# Add percentage labels on top of each bar
text(
  x = seq(0.7, by = 1.2, length.out = nrow(plot_data)),  # Position horizontally
  y = plot_data$Proportion + 0.01,  # Position slightly above bars
  labels = paste0(round(plot_data$Proportion * 100, 1), "%"),  # Format as percentage
  cex = 0.8  # Text size
)

# Create a combined stacked bar chart that shows both actual counts and proportions
par(mar = c(5, 5, 4, 8) + 0.1)  # Adjust margins for second y-axis
bp <- barplot(
  plot_data$Cabins, 
  names.arg = plot_data$Station,
  col = "lightgreen",
  main = "Ice Fishing Cabins by Station (2018)",
  ylab = "Number of Cabins",
  xlab = "Station",
  ylim = c(0, max(plot_data$Cabins) * 1.1),  # Add space for labels
  las = 1  # Make y-axis labels horizontal
)

# Add cabin count labels
text(
  x = bp,  # Use barplot positions
  y = plot_data$Cabins + max(plot_data$Cabins) * 0.03,
  labels = plot_data$Cabins,
  cex = 0.8
)

# Add percentage labels below the count
text(
  x = bp,
  y = plot_data$Cabins - max(plot_data$Cabins) * 0.06,
  labels = paste0("(", round(plot_data$Proportion * 100, 1), "%)"),
  cex = 0.7,
  col = "darkgreen"
)
```
```{r comparison years}
# Create a data frame with cabin numbers by site from 2014-2018
cabin_by_site <- data.frame(
  Site = c("Anse-à-Benjamin", "Grande-Baie", "Les Battures", 
           "L'Anse-St-Jean", "Rivière-Éternité", "St-Félix-d'Otis",
           "Ste-Rose-du-Nord", "Saint-Fulgence"),
  
  Y2014 = c(533, 650, 0, 78, 35, 25, 59, 119),
  Y2015 = c(570, 562, 0, 102, 26, 21, 70, 0),
  Y2016 = c(531, 547, 0, 116, 22, 23, 67, 0),
  Y2017 = c(462, 475, 0, 105, 25, 25, 0, 101),
  Y2018 = c(479, 428, 0, 148, 27, 25, 87, 101)
)

# Reshape data for plotting
library(reshape2)
cabin_long <- melt(cabin_by_site, id.vars = "Site", 
                  variable.name = "Year", value.name = "Cabins")
# Clean year labels
cabin_long$Year <- substring(as.character(cabin_long$Year), 2)

# Convert site to factor to maintain order
cabin_long$Site <- factor(cabin_long$Site, levels = cabin_by_site$Site)

# Create a grouped bar chart
library(ggplot2)
ggplot(cabin_long, aes(x = Site, y = Cabins, fill = Year)) +
  geom_bar(stat = "identity", position = "dodge") +
  scale_fill_brewer(palette = "Blues") +
  theme_minimal() +
  labs(title = "Number of Ice Fishing Cabins by Site (2014-2018)",
       x = "Site", 
       y = "Number of Cabins") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1),
        legend.position = "top") +
  scale_y_continuous(expand = c(0, 0), limits = c(0, 700))
```
```{r full stations }
# Create a data frame with total cabin numbers from 2014-2018
total_cabins_data <- data.frame(
  Year = c("2014", "2015", "2016", "2017", "2018"),
  Cabins = c(1554, 1427, 1212, 1351, 1400)
)

# Set up plot parameters
par(mar = c(5, 5, 4, 2) + 0.1)  # Adjust margins

# Create the bar chart
bp <- barplot(
  total_cabins_data$Cabins, 
  names.arg = total_cabins_data$Year,
  col = "skyblue",
  main = "Total Number of Ice Fishing Cabins (2014-2018)",
  ylab = "Number of Cabins",
  xlab = "Year",
  ylim = c(0, max(total_cabins_data$Cabins) * 1.1),  # Add space for labels
  las = 1,  # Make y-axis labels horizontal
  cex.axis = 0.9,  # Adjust size of axis labels
  cex.names = 1.0  # Adjust size of year labels
)

# Add cabin count labels on top of each bar
text(
  x = bp,  # Use barplot positions
  y = total_cabins_data$Cabins + 50,  # Position slightly above bars
  labels = format(total_cabins_data$Cabins, big.mark=","),  # Add thousand separator
  cex = 0.9,  # Text size
  col = "black"
)

# Add percentage change compared to 2014 (baseline)
baseline <- total_cabins_data$Cabins[1]  # 2014 value
percent_change <- ((total_cabins_data$Cabins / baseline) - 1) * 100

# Add percent change labels below each bar (except 2014)
for (i in 2:length(bp)) {
  change_val <- percent_change[i]
  color <- ifelse(change_val < 0, "red", "green4")
  sign <- ifelse(change_val < 0, "", "+")
  
  # Only add change label for non-baseline years
  text(
    x = bp[i],
    y = total_cabins_data$Cabins[i] - 80,  # Position below bars
    labels = paste0("(", sign, round(change_val, 1), "%)"),
    cex = 0.8,
    col = color
  )
}

# Add a reference line for the 2014 baseline
abline(h = baseline, lty = 2, col = "gray60")
text(x = 0.5, y = baseline + 30, labels = "2014 baseline", cex = 0.7, col = "gray40")

# Optional: To show trend, add a line connecting the tops of bars
lines(bp, total_cabins_data$Cabins, type = "l", lwd = 2, col = "navy")
points(bp, total_cabins_data$Cabins, pch = 19, col = "navy")
```
